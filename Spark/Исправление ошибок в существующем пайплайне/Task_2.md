В существующем пайплайне обработки данных о пользователях и их транзакциях есть несколько ошибок и недоработок, которые необходимо исправить.

Исходные данные:

Файл users.csv лежит в S3
Файл transactions.csv лежит в S3

Описание данных:

users.csv

Колонка	Тип	Описание
user_id	Integer	Уникальный идентификатор пользователя
email	String	Email пользователя
registration_date	Date	Дата регистрации
...		
С остальными полями ознакомьтесь с ними самостоятельно.

transactions.csv

Колонка	Тип	Описание
transaction_id	Integer	Уникальный идентификатор транзакции
user_id	Integer	Идентификатор пользователя
transaction_date	Timestamp	Дата и время транзакции
amount	Double	Сумма транзакции
status	String	Статус транзакции ('completed', 'failed', 'pending')
payment_method	String	Метод оплаты (обратите внимание на качество данных в этом поле)
currency	String	Валюта (обратите внимание на качество данных в этом поле)


В целом желательно, как минимум, просмотреть глазами небольшую выборку данных из каждого поля, чтобы примерно понимать состояние качества данных. 
Более тщательный подход предполагает сбор статистики по каждому полю. 
Например, подсчет уникальных значений и понимание как они выглядят, проверка на null и число null или пустых строк.

Ошибки для исправления

В текущем пайплайне есть следующие проблемы:

1. Нам нужны только пользователи с транзакциями

2. Не обрабатываются null значения и пустые строки:

   - В поле amount и других полях могут быть null значения или пустые строки

   - Необходимо корректно их обработать при расчёте total_amount

3. Не стандартизированы строковые поля:

   - payment_method и currency записаны в разных регистрах

   - Нужно привести их к единому формату (нижний регистр)

4. Не фильтруются failed транзакции:

   - В расчёт попадают все транзакции, включая failed

   - Нужно учитывать только успешные (status = 'completed')

 

Задача

1. Изучите существующий код пайплайна

2. Найдите и исправьте все перечисленные ошибки

3. Добавьте проверки качества данных для валидации исправлений

 

Ожидаемый результат

Пайплайн должен:

- Учитывать только completed транзакции

- Правильно обрабатывать null значения

- Использовать стандартизированные значения полей

 

Проверки

В финальном DataFrame:

- Не должно быть дубликатов по user_id

- Не должно быть null значений в total_amount

- Все строковые поля должны быть в нижнем регистре